<%= render partial: 'header' %>

<div class="event-window">
  <div class="header-back">
    <%= link_to events_path do %>
      <%= image_tag "https://res.cloudinary.com/dn2p7hun2/image/upload/v1701342794/ubz1svndcbosxqlhqzaq.svg" %>
      <p>retour</p>
    <% end %>
  </div>

  <p class="card-category-title"><%= @event.category.name.upcase %></p>
  <h1 class="page-title"><%= @event.title %></h1>
  <div class="bg-image-event"></div>

  <div class="event-bloc">
    <p class="chapo margin-event"><%= @event.short_description %></p>
    <p class="small-infos margin-event" id="event-address"><%= @event.address %></p>

    <!-- Map Section -->
    <div class="mapShow">
      <div id="mapContainer" style="width: 100%; height: 0;"
        data-controller="map-event"
        data-map-event-markers-value="<%= @markers.to_json %>"
        data-map-event-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
        <button data-map-event-target="btn" data-action="click->map-event#loadMap">Show Map</button>
      </div>

      <script>
        document.addEventListener("DOMContentLoaded", function() {
          const mapContainer = document.getElementById("mapContainer");
          const mapButton = document.querySelector("[data-map-event-target='btn']");

          mapButton.addEventListener("click", function() {
            mapContainer.style.height = (mapContainer.style.height === "0px") ? "600px" : "0";
            // Trigger the map loading logic if needed
            if (mapContainer.style.height === "600px") {
              mapContainer.dispatchEvent(new Event('mapShown'));
            }
          });
        });
      </script>
    </div>

